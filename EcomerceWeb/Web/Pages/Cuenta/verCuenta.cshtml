@page
@model Web.Pages.Cuenta.verCuentaModel
@{
}
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery

<head>

	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
	<link href="~/css/vercuenta.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
</head>

<input type="hidden" id="__RequestVerificationToken" value="@Antiforgery.GetAndStoreTokens(HttpContext).RequestToken" />
<div class="container-xxl py-4 account-wrap" style="margin-top:150px;">
	<div class="row g-4">


		<div class="col-lg-3 account-sidebar">
			<div class="card-soft">
				<div class="profile-box">
					<img src="https://imagenes.heraldo.es/files/image_1920_1080/uploads/imagenes/2025/02/18/ibai-llanos-sin-barba-en-su-ultima-publicacion-en-redes-sociales.png" class="perfil" alt="" style="height:60px; width:60px;">
					<div>
						<p class="username">@Html.DisplayFor(modelo => modelo.usuario.NombreUsuario)</p>
						<small class="text-white-50">Mi cuenta</small>
					</div>
				</div>
				<nav class="nav flex-column">
					<a class="nav-link active" data-bs-toggle="tab" href="#tab-personal">
						<i class="bi bi-person"></i> Información Personal
					</a>
					<a class="nav-link" data-bs-toggle="tab" href="#tab-cart">
						<i class="bi bi-cart"></i> Mis pedidos
					</a>
					<a class="nav-link" data-bs-toggle="tab" href="#tab-addresses">
						<i class="bi bi-geo-alt"></i> Direcciones
					</a>
					<a class="nav-link" asp-page="/Cuenta/CerrarSession">
						<i class="bi bi-box-arrow-right"></i> Cerrar sesión
					</a>
					<a class="nav-link text-danger" href="javascript:void(0);" onclick="confirmarDesactivacion()">
						<i class="bi bi-x-circle"></i> Desactivar cuenta
					</a>
				</nav>
			</div>
		</div>

		<div class="col-lg-9 account-content">
			<div class="tab-content">


				<div class="tab-pane fade show active" id="tab-personal">
					<div class="card-soft">
						<div class="card-header soft">
							<h5 class="title">Información Personal</h5>
							<p class="subtitle">Actualiza tu información personal y de contacto</p>
						</div>

						<div class="card-body">
							<form method="post">
								<div class="row g-3">
									<div class="col-md-6">
										<div class="form-floating">
											<input type="text" asp-for="usuario.NombreUsuario" class="form-control" id="nombreUsuario" value="@Model.usuario.NombreUsuario">
											<span asp-validation-for="usuario.NombreUsuario" class="text-danger"></span>
											<label for="nombreUsuario">Nombre</label>
										</div>
									</div>
									<div class="col-md-6">
										<div class="form-floating">
											<input type="text" asp-for="usuario.Apellido" class="form-control" id="apellidos" value="@Model.usuario.Apellido">
											<span asp-validation-for="usuario.Apellido" class="text-danger"></span>
											<label for="apellidos">Apellidos</label>
										</div>
									</div>

									<div class="col-12">
										<div class="form-floating">
											<input type="email" asp-for="usuario.CorreoElectronico" class="form-control" id="email" readonly>
											<span asp-validation-for="usuario.CorreoElectronico" class="text-danger"></span>
											<label for="email">Correo Electrónico</label>
										</div>
									</div>

									<div class="col-md-6">
										<div class="form-floating">
											<input type="tel" asp-for="usuario.Telefono" class="form-control" id="phone" value="@Model.usuario.Telefono">
											<span asp-validation-for="usuario.Telefono" class="text-danger"></span>
											<label for="phone">Teléfono</label>
										</div>
									</div>
									<div class="col-md-6">
										<div class="form-floating">
											<input type="tel" asp-for="usuario.Direccion" class="form-control" id="direccion" value="@Model.usuario.Direccion">
											<span asp-validation-for="usuario.Direccion" class="text-danger"></span>
											<label for="direccion">Dirección</label>
										</div>
									</div>

									
								</div>

								<div class="card-footer sticky d-flex justify-content-end gap-2 mt-3">
									<button type="reset" class="btn btn-light btn-rounded">Cancelar</button>
									<button type="submit" class="btn btn-primary btn-rounded">
										<i class="bi bi-check2-circle me-1"></i> Guardar Cambios
									</button>
								</div>
							</form>
						</div>
					</div>
				</div>


				<div class="tab-pane fade" id="tab-cart">
					<div class="card-soft">
						<div class="card-header soft">
							<h5 class="title">Mis pedidos</h5>
							<p class="subtitle">Resumen de tus pedidps realizados</p>
						</div>


					</div>
				</div>

				<div class="tab-pane fade" id="tab-addresses">
					<div class="card-soft">
						<div class="card-header soft">
							<h5 class="title">Direcciones</h5>
							<p class="subtitle">Gestiona tus direcciones de envío</p>
						</div>

					</div>
				</div>

			</div>
		</div>

	</div>
</div>
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
	<script src="~/js/navcategorias.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script>
				function confirmarDesactivacion() {
			const token = document.getElementById("__RequestVerificationToken").value;

			Swal.fire({
				title: '¿Estás seguro?',
				text: "Tu cuenta será desactivada permanentemente.",
				icon: 'warning',
				showCancelButton: true,
				confirmButtonColor: '#8e44ad',
				cancelButtonColor: '#d33',
				confirmButtonText: 'Sí, desactivar',
				cancelButtonText: 'Cancelar'
			}).then((result) => {
				if (!result.isConfirmed) return;

				fetch("/Cuenta/VerCuenta?handler=Desactivar", {
					method: "POST",
					headers: {
						"Content-Type": "application/x-www-form-urlencoded",
						"RequestVerificationToken": token
					},
					body: "" 
				})
				.then(async r => {
					const data = await r.json().catch(() => null);

					if (!r.ok) {
						Swal.fire("Error", data?.error || "No se pudo desactivar la cuenta", "error");
					} else {
						Swal.fire("Listo", data?.mensaje || "Cuenta desactivada", "success")
							.then(() => window.location.href = "/Cuenta/CerrarSession");
					}
				})
				.catch(err => {
					Swal.fire("Error", "Ocurrió un error al desactivar la cuenta", "error");
					console.error(err);
				});
			});
		}
	</script>

	}